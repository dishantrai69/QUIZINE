<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QUIZINE</title>
<style>
/* Apple-like design: Reset + Base */
* { margin:0; padding:0; box-sizing:border-box; }
body, html {
  height:100%;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: #f5f5f7;
  color:#1c1c1e;
  display:flex; justify-content:center; align-items:center;
  transition: background 0.4s ease, color 0.4s ease;
}
body.dark { background:#000; color:#f5f5f7; }

/* Apple glassmorphic card */
.card {
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(25px);
  border-radius: 30px;
  padding: 40px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.15);
  max-width: 480px;
  width: 90%;
  transition: 0.4s ease;
}
body.dark .card {
  background: rgba(30, 30, 30, 0.7);
  box-shadow: 0 8px 32px rgba(255,255,255,0.05);
}

/* Header */
h1 {
  font-size: 2.5rem;
  text-align:center;
  margin-bottom: 25px;
  font-weight: 600;
}

/* Inputs and Selects */
input, select {
  padding:14px;
  font-size:1rem;
  border-radius: 14px;
  border:1px solid rgba(0,0,0,0.1);
  outline:none;
  transition: 0.2s;
  background: rgba(255,255,255,0.8);
}
input:focus, select:focus {
  border-color:#007aff;
  box-shadow:0 0 0 3px rgba(0,122,255,0.2);
}
body.dark input, body.dark select {
  background: rgba(40,40,40,0.8);
  color:#f5f5f7;
  border:1px solid rgba(255,255,255,0.1);
}

/* Button */
button {
  padding:14px;
  border:none;
  border-radius: 14px;
  font-size:1rem;
  font-weight:600;
  cursor:pointer;
  background: linear-gradient(135deg, #007aff, #00c6ff);
  color:white;
  transition: transform 0.2s, background 0.3s;
}
button:hover { transform: scale(1.03); }
body.dark button {
  background: linear-gradient(135deg, #34c759, #30d158);
  color:#000;
}

/* Quiz card */
.quiz-card {
  margin-top:20px;
  padding:20px;
  border-radius:20px;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(15px);
  transition:0.3s;
}
body.dark .quiz-card { background: rgba(40,40,40,0.6); }
.quiz-card:hover { transform: scale(1.01); }

/* Options like Apple buttons */
.options { display:flex; flex-direction:column; gap:12px; margin-top:15px; }
.option {
  padding:12px; border-radius:12px;
  text-align:center; border:1px solid rgba(0,0,0,0.1);
  cursor:pointer; transition: 0.3s;
  background: rgba(255,255,255,0.8);
}
.option:hover { background:#007aff; color:#fff; }
body.dark .option:hover { background:#34c759; color:#000; }
.correct { background:#34c759 !important; color:#fff !important; }
.incorrect { background:#ff3b30 !important; color:#fff !important; }

.show-answer { margin-top:10px; font-size:0.9rem; color:#ff9500; }
#progress { margin-top:12px; text-align:center; font-weight:500; }

/* Dark/Light toggle button */
#themeToggle {
  position:absolute; top:20px; right:20px;
  padding:8px 14px;
  border-radius:14px;
  background:#007aff; color:#fff; border:none;
  cursor:pointer; transition:0.3s;
}
body.dark #themeToggle { background:#34c759; color:#000; }
#themeToggle:hover { transform: scale(1.05); }

/* Confetti */
#confetti {
  position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; display:none;
}
</style>
</head>
<body>

<button id="themeToggle">🌙 Dark Mode</button>

<div class="card">
  <h1>QUIZINE</h1>
  <form id="quizForm">
    <input type="text" id="topic" placeholder="Enter topic (e.g., football)" required>
    <select id="numQuestions">
      <option value="5">5 Questions</option>
      <option value="10">10 Questions</option>
    </select>
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    <button type="submit">Generate Quiz</button>
  </form>
  <div id="progress"></div>
  <div id="quizContainer"></div>
</div>

<canvas id="confetti"></canvas>

<script>
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  themeToggle.textContent = document.body.classList.contains("dark") ? "☀️ Light Mode" : "🌙 Dark Mode";
});

const quizForm = document.getElementById("quizForm");
const quizContainer = document.getElementById("quizContainer");
const progress = document.getElementById("progress");

let quizData = [], currentIndex = 0, score = 0;

quizForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  quizContainer.innerHTML = "<p>Loading quiz...</p>";
  progress.textContent = "";
  score = 0; currentIndex = 0;

  const topic = document.getElementById("topic").value;
  const numQuestions = parseInt(document.getElementById("numQuestions").value);
  const difficulty = document.getElementById("difficulty").value;

  try {
    const res = await fetch("/generate-quiz", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ topic, numQuestions, difficulty })
    });
    quizData = await res.json();
    displayQuestion(currentIndex);
  } catch {
    quizContainer.innerHTML = "<p>Failed to load quiz. Try again.</p>";
  }
});

function displayQuestion(index) {
  if(index >= quizData.length) {
    quizContainer.innerHTML = `<h2>Quiz Completed! Score: ${score}/${quizData.length}</h2>`;
    triggerConfetti(); return;
  }

  const q = quizData[index];
  quizContainer.innerHTML = "";
  const card = document.createElement("div");
  card.className = "quiz-card";

  const question = document.createElement("h3");
  question.textContent = `${index+1}. ${q.question}`;
  card.appendChild(question);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  q.options.forEach(opt => {
    const optionBtn = document.createElement("div");
    optionBtn.className = "option";
    optionBtn.textContent = opt;
    optionBtn.addEventListener("click", () => {
      if(optionBtn.classList.contains("correct") || optionBtn.classList.contains("incorrect")) return;
      if(opt === q.correctAnswer) { optionBtn.classList.add("correct"); score++; }
      else { optionBtn.classList.add("incorrect"); }
      setTimeout(() => { currentIndex++; displayQuestion(currentIndex); }, 600);
    });
    optionsDiv.appendChild(optionBtn);
  });

  card.appendChild(optionsDiv);
  const showAnswer = document.createElement("div");
  showAnswer.className = "show-answer";
  showAnswer.textContent = `Answer: ${q.correctAnswer}`;
  card.appendChild(showAnswer);

  quizContainer.appendChild(card);
  progress.textContent = `Question ${index+1} of ${quizData.length} | Score: ${score}`;
}

// Confetti animation
const confettiCanvas = document.getElementById("confetti");
const confettiCtx = confettiCanvas.getContext("2d");
let confettiParticles = [];
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;

function triggerConfetti() {
  confettiCanvas.style.display = "block";
  confettiParticles = Array.from({length:120}, () => ({
    x: Math.random()*window.innerWidth,
    y: Math.random()*window.innerHeight - window.innerHeight,
    r: Math.random()*6+4,
    d: Math.random()*10+5,
    color: `hsl(${Math.random()*360},100%,50%)`,
    tilt: Math.random()*10-5
  }));
  requestAnimationFrame(updateConfetti);
  setTimeout(()=> confettiCanvas.style.display="none",3500);
}

function updateConfetti() {
  confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confettiParticles.forEach(p => {
    confettiCtx.beginPath();
    confettiCtx.fillStyle = p.color;
    confettiCtx.moveTo(p.x+ p.tilt, p.y);
    confettiCtx.lineTo(p.x+ p.tilt + p.r/2, p.y + p.r);
    confettiCtx.lineTo(p.x+ p.tilt - p.r/2, p.y + p.r);
    confettiCtx.fill();
    p.y += 2 + p.d/5;
    if(p.y>window.innerHeight) p.y=-10;
  });
  if(confettiCanvas.style.display==="block") requestAnimationFrame(updateConfetti);
}

window.addEventListener("resize",()=>{confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight});
</script>
</body>
</html>
