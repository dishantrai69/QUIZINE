<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QUIZINE</title>
<style>
/* ----- Reset & body ----- */
body, html {
  margin:0; padding:0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background:#f5f5f7; color:#111;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh; transition: background 0.3s, color 0.3s;
}
body.dark { background:#111; color:#f2f2f7; }

/* ----- Main card ----- */
.card {
  background:#fff; 
  border-radius:30px; 
  padding:40px; 
  box-shadow:0 30px 60px rgba(0,0,0,0.1);
  width: 90%; max-width:500px;
  transition: 0.3s;
}
body.dark .card { background:#1c1c1e; box-shadow:0 30px 60px rgba(255,255,255,0.05); }

/* ----- Header ----- */
h1 { font-size:2.5rem; margin:0 0 30px 0; font-weight:700; text-align:center; }

/* ----- Form ----- */
form { display:flex; flex-direction:column; gap:15px; }
input, select {
  padding:15px; font-size:1rem; border-radius:15px; border:1px solid #ccc; outline:none;
  transition:0.2s;
}
input:focus, select:focus { border-color:#007aff; }
body.dark input:focus, body.dark select:focus { border-color:#34c759; }
button {
  padding:15px; font-size:1rem; font-weight:700; border:none; border-radius:20px;
  background:linear-gradient(135deg,#007aff,#00c6ff); color:#fff; cursor:pointer;
  transition:0.3s, transform 0.2s;
}
button:hover { transform:translateY(-2px); }
body.dark button { background:linear-gradient(135deg,#34c759,#28a745); color:#111; }

/* ----- Quiz card ----- */
.quiz-card {
  background:#fdfdfd; border-radius:25px; padding:25px; margin-top:20px;
  box-shadow:0 15px 40px rgba(0,0,0,0.1); transition:0.3s, transform 0.3s;
}
body.dark .quiz-card { background:#1c1c1e; box-shadow:0 15px 40px rgba(255,255,255,0.05); }
.quiz-card:hover { transform:translateY(-5px); }

.options { display:flex; flex-direction:column; gap:15px; margin-top:20px; }
.option {
  padding:12px 15px; border-radius:20px; border:1px solid #ccc; cursor:pointer;
  transition:0.2s, transform 0.2s;
}
.option:hover { background:#007aff; color:#fff; transform:translateX(5px); }
body.dark .option:hover { background:#34c759; color:#111; transform:translateX(5px); }
.correct { background:#4cd964 !important; color:#fff !important; }
.incorrect { background:#ff3b30 !important; color:#fff !important; }

.show-answer { margin-top:12px; font-weight:600; color:#ff9500; }
#progress { margin-top:15px; font-weight:600; text-align:center; }

/* ----- Theme toggle ----- */
#themeToggle { position:absolute; top:20px; right:20px; padding:10px 20px; border-radius:20px; border:none;
  background:#007aff; color:#fff; cursor:pointer; transition:0.3s; }
#themeToggle:hover { transform:translateY(-2px); }
body.dark #themeToggle { background:#34c759; color:#111; }
body.dark #themeToggle:hover { transform:translateY(-2px); }

/* ----- Confetti ----- */
#confetti {
  position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; display:none;
}
</style>
</head>
<body>

<button id="themeToggle">🌙 Dark Mode</button>

<div class="card">
  <h1>QUIZINE</h1>
  <form id="quizForm">
    <input type="text" id="topic" placeholder="Enter topic (e.g., football)" required>
    
    <select id="numQuestions">
      <option value="5">5 Questions</option>
      <option value="10">10 Questions</option>
    </select>
    
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    
    <button type="submit">Generate Quiz</button>
  </form>

  <div id="progress"></div>
  <div id="quizContainer"></div>
</div>

<canvas id="confetti"></canvas>

<script>
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  themeToggle.textContent = document.body.classList.contains("dark") ? "☀️ Light Mode" : "🌙 Dark Mode";
});

const quizForm = document.getElementById("quizForm");
const quizContainer = document.getElementById("quizContainer");
const progress = document.getElementById("progress");

let quizData = [];
let currentIndex = 0;
let score = 0;

quizForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  quizContainer.innerHTML = "<p>Loading quiz...</p>";
  progress.textContent = "";
  score = 0;
  currentIndex = 0;

  const topic = document.getElementById("topic").value;
  const numQuestions = parseInt(document.getElementById("numQuestions").value);
  const difficulty = document.getElementById("difficulty").value;

  try {
    const res = await fetch("/generate-quiz", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ topic, numQuestions, difficulty })
    });
    quizData = await res.json();
    displayQuestion(currentIndex);
  } catch (err) {
    console.error(err);
    quizContainer.innerHTML = "<p>Failed to load quiz. Try again.</p>";
  }
});

function displayQuestion(index) {
  if(index >= quizData.length) {
    quizContainer.innerHTML = `<h2>Quiz Completed! Score: ${score}/${quizData.length}</h2>`;
    triggerConfetti();
    return;
  }

  const q = quizData[index];
  quizContainer.innerHTML = "";
  const card = document.createElement("div");
  card.className = "quiz-card";

  const question = document.createElement("h3");
  question.textContent = `${index+1}. ${q.question}`;
  card.appendChild(question);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  q.options.forEach(opt => {
    const optionBtn = document.createElement("div");
    optionBtn.className = "option";
    optionBtn.textContent = opt;

    optionBtn.addEventListener("click", () => {
      if(optionBtn.classList.contains("correct") || optionBtn.classList.contains("incorrect")) return;

      if(opt === q.correctAnswer) { 
        optionBtn.classList.add("correct");
        score++;
      } else { optionBtn.classList.add("incorrect"); }

      setTimeout(() => {
        currentIndex++;
        displayQuestion(currentIndex);
      }, 700);
    });

    optionsDiv.appendChild(optionBtn);
  });

  card.appendChild(optionsDiv);

  const showAnswer = document.createElement("div");
  showAnswer.className = "show-answer";
  showAnswer.textContent = `Answer: ${q.correctAnswer}`;
  card.appendChild(showAnswer);

  quizContainer.appendChild(card);
  progress.textContent = `Question ${index+1} of ${quizData.length} | Score: ${score}`;
}

// Confetti
const confettiCanvas = document.getElementById("confetti");
const confettiCtx = confettiCanvas.getContext("2d");
let confettiParticles = [];
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;

function triggerConfetti() {
  confettiCanvas.style.display = "block";
  confettiParticles = Array.from({length:150}, () => ({
    x: Math.random()*window.innerWidth,
    y: Math.random()*window.innerHeight - window.innerHeight,
    r: Math.random()*6+4,
    d: Math.random()*10+5,
    color: `hsl(${Math.random()*360},100%,50%)`,
    tilt: Math.random()*10-5
  }));
  requestAnimationFrame(updateConfetti);
  setTimeout(()=> confettiCanvas.style.display="none",4000);
}

function updateConfetti() {
  confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confettiParticles.forEach(p => {
    confettiCtx.beginPath();
    confettiCtx.fillStyle = p.color;
    confettiCtx.moveTo(p.x+ p.tilt, p.y);
    confettiCtx.lineTo(p.x+ p.tilt + p.r/2, p.y + p.r);
    confettiCtx.lineTo(p.x+ p.tilt - p.r/2, p.y + p.r);
    confettiCtx.fill();
    p.y += 2 + p.d/5;
    if(p.y>window.innerHeight) p.y=-10;
  });
  if(confettiCanvas.style.display==="block") requestAnimationFrame(updateConfetti);
}

window.addEventListener("resize",()=>{confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight});
</script>
</body>
</html>
